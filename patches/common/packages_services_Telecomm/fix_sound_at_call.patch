From 9f9a85e002c0ec22a2cb26b96148c63f9174be7b Mon Sep 17 00:00:00 2001
From: vlw <vlw@users.noreply.github.com>
Date: Fri, 4 Nov 2016 10:19:15 +0300
Subject: [PATCH] Update CallAudioManager.java

---
 src/com/android/server/telecom/CallAudioManager.java | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/src/com/android/server/telecom/CallAudioManager.java b/src/com/android/server/telecom/CallAudioManager.java
index 32d70f3..95c8c44 100644
--- a/src/com/android/server/telecom/CallAudioManager.java
+++ b/src/com/android/server/telecom/CallAudioManager.java
@@ -137,6 +137,15 @@ public void handleMessage(Message msg) {
 
                     Log.v(this, "Request to change audio mode from %s to %s", modeToString(oldMode),
                             modeToString(newMode));
+
+
+                    if(newMode == 0) {
+                        mAudioManager.setParameters("TFA_SETVOLUME=0");
+                        mAudioManager.setParameters("realcall=off");
+                    } else if(newMode == AudioManager.MODE_IN_COMMUNICATION || newMode == AudioManager.MODE_RINGTONE
+                                || newMode == AudioManager.MODE_IN_CALL) {
+                        mAudioManager.setParameters("realcall=on");
+                    }
 
                     if (oldMode != newMode) {
                         if (oldMode == AudioManager.MODE_IN_CALL &&
